<div id="je-loading">Loadingâ€¦</div>
<div data-role="content">
  <div class="content-primary je-calendar-page" style="padding: 0 !important;">
    <div id="je-calendar-container"></div>
  </div>
</div>
<div id="je-error" style="display:none">
  Jellyfin Enhanced not ready.
</div>
<script>
(function () {
  const MAX_WAIT = 5000;
  const INTERVAL = 50;
  let waited = 0;

  const loadingEl = document.getElementById("je-loading");
  const errorEl = document.getElementById("je-error");
  const preferencesPages = Array.from(document.querySelectorAll("#userPluginPreferencesPage"));
  const preferencesPage = preferencesPages.find(p => p.offsetWidth > 0 && p.offsetHeight > 0);

  document.querySelectorAll("#je-calendar-container").forEach(el => {
    if (!preferencesPage || !preferencesPage.contains(el)) {
      el.remove();
    }
  });

  if (preferencesPage && !preferencesPage.querySelector("#je-calendar-container")) {
    const newContainer = document.createElement("div");
    newContainer.id = "je-calendar-container";
    const target = document.querySelector(".je-calendar-page") || document.body;
    target.appendChild(newContainer);
  }

  const JE = window.JellyfinEnhanced;

  const timer = setInterval(() => {

    if (JE && JE.calendarPage) {
      clearInterval(timer);

      loadingEl.remove();
      JE.calendarPage.injectStyles();
      JE.calendarPage.loadSettings();
      JE.calendarPage.renderPage();
      JE.calendarPage.refresh()
      document.addEventListener("click", JE.calendarPage.handleEventClick);
      console.log('ðŸª¼ Jellyfin Enhanced: Calendar Page Loaded.');
      return;
    }

    waited += INTERVAL;
    if (waited >= MAX_WAIT) {
      clearInterval(timer);

      loadingEl.style.display = "none";
      errorEl.style.display = "block";
    }
  }, INTERVAL);
})();
</script>

<style>
  .je-calendar-header {
    padding-top: 0px;
  }
</style>
