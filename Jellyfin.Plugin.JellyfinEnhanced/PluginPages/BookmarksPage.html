<div id="je-loading">Loading...</div>
<div data-role="content">
  <div class="content-primary je-bookmarks-page">
    <div class="sections bookmarks"></div>
  </div>
</div>
<div id="je-error" style="display:none">
  Jellyfin Enhanced not ready.
</div>
<script>
(function () {
  const MAX_WAIT = 5000;
  const INTERVAL = 50;
  let waited = 0;

  const loadingEl = document.getElementById("je-loading");
  const errorEl = document.getElementById("je-error");
  const preferencesPages = Array.from(document.querySelectorAll("#userPluginPreferencesPage"));
  const preferencesPage = preferencesPages.find(p => p.offsetWidth > 0 && p.offsetHeight > 0);

  document.querySelectorAll(".sections.bookmarks").forEach(el => {
    if (!preferencesPage || !preferencesPage.contains(el)) {
      el.remove();
    }
  });

  if (preferencesPage && !preferencesPage.querySelector(".sections.bookmarks")) {
    const newContainer = document.createElement("div");
    newContainer.className = "sections bookmarks";
    const target = document.querySelector(".je-bookmarks-page") || document.body;
    target.appendChild(newContainer);
  }

  const timer = setInterval(() => {
    const JE = window.JellyfinEnhanced;

    if (JE && JE.userConfig && JE.bookmarks) {
      clearInterval(timer);
      loadingEl.remove();
      console.log("ðŸª¼ Jellyfin Enhanced: Bookmarks Page Loaded.");
      return;
    }

    waited += INTERVAL;
    if (waited >= MAX_WAIT) {
      clearInterval(timer);
      loadingEl.style.display = "none";
      errorEl.style.display = "block";
    }
  }, INTERVAL);
})();
</script>
