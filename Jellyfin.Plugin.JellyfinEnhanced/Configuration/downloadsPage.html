<!DOCTYPE html>
<html lang="en">
<head>
    <title>Downloads</title>
</head>
<body>
<div class="page type-interior pluginConfigurationPage" data-role="page" id="JellyfinEnhancedDownloadsPage">
    <div data-role="content">
        <div class="content-primary">
            <div id="je-downloads-container">
                <div style="display: flex; justify-content: center; padding: 3em;">
                    <span>Loading...</span>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
(function() {
    'use strict';

    // Wait for the JellyfinEnhanced module to be available
    function waitForJE(callback, maxAttempts) {
        maxAttempts = maxAttempts || 50;
        var attempts = 0;

        function check() {
            attempts++;
            if (window.JellyfinEnhanced && window.JellyfinEnhanced.downloadsPage) {
                callback();
            } else if (attempts < maxAttempts) {
                setTimeout(check, 100);
            } else {
                console.error('[JE Downloads] JellyfinEnhanced module not found after ' + maxAttempts + ' attempts');
                document.getElementById('je-downloads-container').innerHTML =
                    '<div style="text-align:center;padding:3em;opacity:0.5;">Failed to load downloads module. Please refresh the page.</div>';
            }
        }
        check();
    }

    // Initialize when page becomes visible
    document.querySelector('#JellyfinEnhancedDownloadsPage').addEventListener('viewshow', function() {
        waitForJE(function() {
            window.JellyfinEnhanced.downloadsPage.initializePageContent();
        });
    });

    // Cleanup when page is hidden
    document.querySelector('#JellyfinEnhancedDownloadsPage').addEventListener('viewhide', function() {
        if (window.JellyfinEnhanced && window.JellyfinEnhanced.downloadsPage) {
            window.JellyfinEnhanced.downloadsPage.stopPolling();
        }
    });
})();
</script>
</body>
</html>
